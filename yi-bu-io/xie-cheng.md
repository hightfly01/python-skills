### 协程

协程：可以认为是比线程更小的执行单元，并且在一个线程中执行。又称‘微线程’。它在执行过程中，在子程序内部可中断，然后转而执行别的子程序，在适当的时候再返回来接着执行，同时还保留之前的信息。

优点：

* 极高的执行效率，因为子程序切换而不是线程切换，没有了线程切换开销。

* 不需要多线程的锁机制，因为只有一个线程，也不存在同时写变量冲突，在协程中控制共享资源不加锁，只需要判断状态就好了，所以执行效率比多线程高很多

* 在IO密集型的程序中，切换协程实现多任务，效率高，占用资源少。因为IO密集型程序中，使用同步IO来切换切换线程，浪费性能。通过异步IO，当数据到达时，触发回调，来减少线程的切换，但是代码可读性很低。而协程通过这种对异步IO的封装 既保留了性能也保证了代码的容易编写和可读性。在高IO密集型的程序下很好。但是高CPU密集型的程序下没啥好处。

缺陷：

协程的切换操作系统并感知，需要让执行的协程获得操作系统CPU的上下文时间成了问题。

### 协程和线程差异 {#协程和线程差异}

线程切换从操作系统层面上，不仅保存和恢复CPU上下文，而且保存和恢复每个线程的缓存数据。因此线程的切换非常耗性能。

协程切换只是单纯的操作CPU上下，切换效率很高。





